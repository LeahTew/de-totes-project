container-job:
    runs-on: ubuntu-latest
    # needs: run-checks

    services:
      postgres:
        image: postgres:10.8
        env:
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: postgres
        ports:
        - 5432:5432
        
        options: --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5

    steps:
    - name: Checkout Repo
      uses: actions/checkout@v4 

    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Setup venv
      run: make requirements

    - name: Create test database
      run: psql -f ./test_db/test_database.sql
      # working-directory: ./postgres

    - name: Seed test database
      run: psql -f ./test_db/test_db_inserts.sql
      # working-directory: ./postgres
      env:
        POSTGRES_HOST: postgres
        POSTGRES_PORT: ${{ job.services.postgres.ports[5432] }}

  vm-job:
    runs-on: ubuntu-latest
    needs: container-job

    services:
      postgres:
        image: postgres:10.8
        env:
          POSTGRES_USER: postgres
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: postgres
        ports:
        - 5432/tcp
       
        options: --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5

    steps:
    - name: Checkout Repo
      uses: actions/checkout@v4 

    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Setup venv
      run: make requirements

    - name: Create test database
      run: psql -f ./test_db/test_database.sql
      # working-directory: ./postgres

    - name: Seed test database
      run: psql -f ./test_db/test_db_inserts.sql
      # working-directory: ./postgres
      env:
        POSTGRES_HOST: localhost
        POSTGRES_PORT: ${{ job.services.postgres.ports[5432] }}


        #services:
      #postgres:
       # image: postgres
      #  env:
       #   POSTGRES_PASSWORD: password
       # options: >-
       #   --health-cmd pg_isready
        #  --health-interval 10s
        #  --health-timeout 5s
        #  --health-retries 5